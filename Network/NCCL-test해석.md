
### NCCL 테스트는 독립적
```
NCCL Tests 구조:

┌─────────────────────────┐
│  all_reduce_perf        │  ← 독립 실행 프로그램
│  (C++ 바이너리)           │
├─────────────────────────┤
│  NCCL 라이브러리           │  ← 직접 호출
│  (libnccl.so)           │
├─────────────────────────┤
│  CUDA                   │
├─────────────────────────┤
│  EFA                    │
└─────────────────────────┘

PyTorch는 필요 없음! ✅

```


### NCCL 테스트 결과 읽기
```
# 출력:
#       size    algbw   busbw
      16GB     280GB/s 555GB/s

해석:
├─ 16GB 데이터 전송함
├─ 실제 속도: 280 GB/s ← 이것 보기!
├─ 효율 지표: 555 GB/s ← 참고용
└─ 목표: Algbw를 400 GB/s에 가깝게!

```

### 공식의 의미
```
Algbw (Algorithm Bandwidth):
- 실제 네트워크를 통해 전송되는 데이터량
- 각 노드가 송수신하는 평균 대역폭
- "진짜" 네트워크 사용량

Busbw (Bus Bandwidth):
- 알고리즘 관점에서의 "효과적인" 대역폭
- 데이터가 이동한 총 거리를 고려
- 성능 지표로 사용

2 × (N-1) / N:
- Ring All-Reduce의 통신 패턴 반영
- 2: 송신 + 수신 (양방향)
- (N-1): 데이터가 거치는 홉 수
- N: 전체 노드 수

```


### AllReduce
```
= 모든 컴퓨터가 합계를 알게 하는 방법

방법:
├─ 원형으로 데이터 전달
├─ 조금씩 나눠서 처리
├─ 모두 동시에 작업
└─ 효율적!

단계: 2×(컴퓨터 수 - 1)

```



### Busbw vs 실제 대역폭
```
Busbw = Algbw × (2 × (N-1) / N)

125 노드:
Busbw = Algbw × (2 × 124 / 125)
Busbw = Algbw × 1.984

측정값:
Busbw = 310 GB/s
N = 125 노드

공식 적용:
310 = Algbw × (2 × 124 / 125)
310 = Algbw × 1.984
Algbw = 310 / 1.984
Algbw = 156.25 GB/s

검증:
Busbw = 156.25 × 1.984
Busbw = 310 GB/s ✅

```

### 물리적 한계 계산
```
EFA 대역폭: 400 GB/s (노드당)
노드 수: 125

이론적 최대 Algbw (불가능한 이상):
= 400 GB/s (모든 링크 100% 활용)

이론적 최대 Busbw:
= 400 × (2 × 124 / 125)
= 400 × 1.984
= 793.6 GB/s

실제 달성 가능 최대 (Ring All-Reduce):
Algbw ≈ 180-200 GB/s (45-50% 활용)
Busbw ≈ 357-397 GB/s
```

<img width="889" height="471" alt="image" src="https://github.com/user-attachments/assets/574d01e7-4e6d-4421-99da-6dfa691cf453" />



## 그럼 Algbw = 156.25 GB/s 이 정상적인 상황인가?
```
당신의 현재 성능
125 노드
Busbw = 310 GB/s
Algbw = 156 GB/s
활용도 = 39.1%

```


### 상황: 125개 컴퓨터가 데이터 합산
```
각 컴퓨터: 16GB 데이터
목표: 모두가 합계를 알기
시간: 0.057초 걸림

```



### Algbw 계산
```
"사용자 입장: 16GB를 얼마나 빨리 처리했나?"

Algbw = 16GB / 0.057초 = 280 GB/s

의미:
├─ 실제 네트워크 사용 속도
├─ "280 GB/s로 데이터 전송했구나"
└─ 이것이 중요한 값! ✅

```


### Busbw 계산
```
"네트워크 입장: 실제로 얼마나 많이 전송했나?"

Ring AllReduce 특성:
├─ 248단계 통신 (2×124)
├─ 각 단계마다 조금씩 전송
└─ 총 전송량: 16GB × 1.984 = 31.7GB

Busbw = 31.7GB / 0.057초 = 555 GB/s

의미:
├─ 알고리즘 효율 반영
├─ 비교 목적
└─ 참고용 메트릭

```
